<html>
<head>
	<title>太鼓达人leap测试版</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<link href="../css/style.css" rel="stylesheet">
	<link href="../css/leapstrap.css" rel="stylesheet">
	<script src="../js/jquery.min.js"></script>
	<script type="text/javascript" src="../js/jquery.cookie.js" ></script>
	<script src="../js/leap.min.js"></script>
	<script src="../js/leapstrap.js"></script>
	<script src="../js/holder.js"></script>
	<script src="../js/loadinfo.js"></script>
	
	<script src="../js/loadsong.js"></script>	
	<link href="../css/process.css" rel="stylesheet">
	<link href="../css/game.css" rel="stylesheet">
</head>
<body style="overflow:hidden;height: 100%;" onresize = "changesize()">
	<audio id="buttonplayer" src="../audios/button.ogg"></audio>
<!-- <body> -->
	<div id="hold">
		<img id="mask" src="../images/mask.png">
		<img id="vs" src="../images/vs.png">
		<div id="vssong"></div>

		<img id="avatar1">
		<p id="name1"></p>		
		<label id="level1">Lv.<span id="level_1"></span></label>
		<img style="position:absolute;z-index:6;top:50%;left:20%;" src="../images/level.gif">
		
		<img id="avatar2">
		<p id="name2"></p>		
		<label id="level2">Lv.<span id="level_2"></span></label>
		<img style="position:absolute;z-index:6;top:50%;right:20%;" src="../images/level.gif">
		
		<p style="z-index:6;position:absolute;top:60%;left:44%;color:white;font-size:30px;" >游戏载入中</p>
		<p class="ani_dot" style="position: absolute;top:60%;left:44%;margin-left:160px;color:white;font-size:30px;z-index:6;">...</p> 
		<section id="demo" class="container" style="position: absolute;top:80%;left:22%; z-index:6;text-align:center;">
		        <input type="radio" class="radio" name="progress" value="five" id="five" checked="">
		        <label for="five" class="label"  style="display:none;">
		            5%
		        </label>
		        <input type="radio" class="radio" name="progress" value="twentyfive" id="twentyfive" >
		        <label for="twentyfive" class="label" style="display:none;">
		            25%
		        </label>
		        <input type="radio" class="radio" name="progress" value="fifty" id="fifty">
		        <label for="fifty" class="label" style="display:none;">
		            50%
		        </label>
		        <input type="radio" class="radio" name="progress" value="seventyfive" id="seventyfive">
		        <label for="seventyfive" class="label" style="display:none;">
		            75%
		        </label>
		        <input type="radio" class="radio" name="progress" value="onehundred" id="onehundred">
		        <label for="onehundred" class="label" style="display:none;">
		            100%
		        </label>
	        <div class="progress">
	            <div class="progress-bar">
	            </div>
	        </div>
	    </section>
    </div>
    <script type="text/javascript">
    	function processer1(){
		$('#twentyfive').click();
		}
    	function processer2(){
		$('#fifty').click();
		}
    	function processer3(){
		$('#seventyfive').click();
		}
    	function processer4(){
		$('#onehundred').click();
		}

		window.setTimeout(processer1,1000);
		window.setTimeout(processer2,3000);
		window.setTimeout(processer3,5000);
		window.setTimeout(processer4,5800);
		
		window.setTimeout(function() {
			$("#hold").fadeOut()
		},7000);
		
    </script>

    <!-- 请叫我分割线君 -->


    <img id="ready" style="z-index:4;position:absolute;top:50%;left:50%;margin-left:-14%;margin-top:-5%;" src="../images/go.png">
	<img style="width:100%;height:100%;" src="../images/bg_Theme99-hd.png">
	<img style="position:absolute;z-index:2;top:46px;margin-left:-24px;width:83%;" id="banner" src="../images/banner.png">
	<img class="move" style="position:absolute;z-index:1;top:10px;" src="../images/ren.png">
	<img style="z-index:3;position:absolute;top:50%;left:50%;margin-left:-20%;margin-top:-8%;" src="../images/bongo.png">

	<input type="image" id="_drum0" style="position:absolute;bottom:-80px;left:50%;margin-left:-40%;width:30%; outline-width:0;" src="../images/drum0.png"/>
	<input type="image" id="_drum1" style="position:absolute;bottom:-80px;left:50%;margin-left:-5%;width:32%; outline-width:0;" src="../images/drum1.png"/>

	<div id="info">
		<img id="invent" style="position:absolute;z-index:4;top:12px;right:0px;width:18%;" src="../images/invent.png">
		<p class="playername" id="playername1" style="z-index:4;"></p>
		<!-- <label class="l1">Lv.<span id="l1"></span></label>
		<img class="limg1" src="../images/level.gif"> -->
		<img id="showavatar1">
		<p class="score"  id="score1"  style="z-index:4;">score: <span id="currentscore1"style = "color:#00FF29;">0</span></p>		
		<p class="playername"  id="playername2" style="z-index:4;">
		<!-- 	<label class="level">Lv.<span id="l2"></span></label>
		<img class="levelimg" src="../images/level.gif"> -->
		</p>	
		<img id="showavatar2">		
		<p class="score" id="score2"  style="z-index:4;">score: <span id="currentscore2"style = "color:#00FF29;">0</span></p>	
	</div>

	<div id="song"></div>
	<div id="rhythm"></div>
	<div id="dislevel"></div>
</body>
<script type="text/javascript">
	// $(document).ready(function(){
	$("#ready").hover(
			function(){
    		$("#ready").attr("src","../images/go_hover.png");
    		document.getElementById('buttonplayer').play(); 
			},
			function(){
			$("#ready").attr("src","../images/go.png");
			})
	$(document).on('touchmove', function(e) {
	    e.preventDefault();
	});
	$(document).on('touchstart', function(e) {
		if ($(event.target).attr("id") == "_drum0") {
			// alert("left");
			op_left();
		} else if ($(event.target).attr("id") == "_drum1") {
			// alert("right");
			op_right();
		}
	    // if (e.target.nodeName !== 'INPUT') {
	    //     e.preventDefault();
	    // }
	});
	window.setTimeout(changesize(),0);
	// changesize();
	$('#ready').click(function(){
		readygo();
		// $("#ready").css({"-webkit-animation":"1s disappear linear","-webkit-transform":"scale(2,2)"});
		// setTimeout("$('#ready').fadeOut()",1000);
		// $("#ready").css("opacity",0);
		$('#ready').fadeOut(500);
		$("#_drum0").addClass("jump");
		$("#_drum1").addClass("jump");
	})


	function readygo(){
		document.getElementById("gamesong").play(); 
		$.getJSON(getParameterByName("song_rhythem"),function(data){
		$(".move").css("-webkit-animation",data.length+"s move infinite linear");
		// 节奏点平移动画
		for(j in data.rhythm) {
			beat("#rhythm" + j, data.rhythm[j].time);
		}
		function beat(id, time) {
			setTimeout(function() {
				$(id).addClass("beat");
			}, time);
		}
		});		
	}


	var tempscore = 0;
	var combo = 0;
	var tempcombo = 0;
	var miss = 0;
	var cool = 0;
	var perfect = 0;
	$(document).keydown(function(event){ 		
		if(event.keyCode == 70){
			op_left();
			getscore();
		}                    
		if(event.keyCode == 74){
			op_right();
			getscore();
		}
	})  

	function op_left(){

			$("#_drum0").animate({
				bottom:'-70px',
			    width:'32%'
			},20, function() {
				$("#_drum0").animate({
					bottom:'-80px',
				    width:'30%'
				});
			});
			$.getJSON(getParameterByName("song_rhythem"),function(data){			
			for(var n in data.rhythm){
				if(data.rhythm[n].color == "huang"){
					// left_perfect
					if(parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth > 0.01 && parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth < 0.04){
						// console.log(n+":"+ parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth*100+"%");
						// console.log("left_perfect");
						$("#"+"rhythm"+n).css("visibility","hidden");
						tempscore += 5;						
						$("#currentscore1").html(tempscore);
						perfect++;
						// console.log("perfect:"+perfect);
						tempcombo++;
						n++;	
						// 动画
						strlevel = "<img id='perfect"+n +"' style='position:absolute;top:40px;left:1.5%;z-index:4;width:10%;' src='../images/perfect.png'>";
						$("#dislevel").empty();
						document.getElementById("dislevel").innerHTML = document.getElementById("dislevel").innerHTML+strlevel; 
						$( "#" +"perfect" + n).animate({top:'-=60px',opacity:'0',width:'150px'},"slow", function() {
						});
						continue;
						}
					// left_cool
					if(parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth > 0.04 && parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth < 0.07){
						// console.log(n+":"+ parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth*100+"%");
						// console.log("left_cool");
						$("#"+"rhythm"+n).css("visibility","hidden");
						tempscore += 3;
						$("#currentscore1").html(tempscore);						
						cool++;
						// console.log("cool:"+cool);
						tempcombo++;
						n++;		
						// 动画
						strlevel = "<img id='cool"+n +"' style='position:absolute;top:40px;left:1.5%;z-index:4;width:10%;' src='../images/cool.png'>";
						$("#dislevel").empty();
						document.getElementById("dislevel").innerHTML = document.getElementById("dislevel").innerHTML+strlevel; 
						$( "#" +"cool" + n).animate({top:'-=60px',opacity:'0',width:'150px'},"slow",function() {
						});
						continue;
						}	
					// left_miss
					if(parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth > 0.07 && parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth < 0.15||parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth < 0.01&&parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth > -0.01){
						// console.log(n+":"+ parseInt($("#"+"rhythm"+n).css("left"))/document.body.clientWidth*100+"%");
						// console.log("left_miss");					
						miss++;
						// console.log("miss:"+miss);
						if(tempcombo > combo){
							combo = tempcombo;
							tempcombo = 0;
							// console.log(combo);
							}
						else{
							tempcombo = 0;
						}
						n++;	
						// 动画
						strlevel = "<img id='miss"+n +"' style='position:absolute;top:40px;left:1.5%;z-index:4;width:10%;' src='../images/miss.png'>";
						$("#dislevel").empty();
						document.getElementById("dislevel").innerHTML = document.getElementById("dislevel").innerHTML+strlevel; 
						$( "#" +"miss" + n).animate({top:'-=60px',opacity:'0',width:'150px'},"slow",function() {
						});
						continue;
						}
					else{
						continue;
					}
				}
			}
	});
	
	}
	function op_right(){
			$("#_drum1").animate({
				bottom:'-70px',
			    width:'32%'
			},20, function() {
				$("#_drum1").animate({
					bottom:'-80px',
				    width:'30%'
				});
			});
			$.getJSON(getParameterByName("song_rhythem"),function(data){			
			for(var m in data.rhythm){
				if(data.rhythm[m].color == "hong"){
					// right_perfect
					if(parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth > 0.01 && parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth < 0.04){
						// console.log(m+":"+ parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth*100+"%");
						// console.log("right_perfect");
						$("#"+"rhythm"+m).remove();
						tempscore += 5;			
						$("#currentscore1").html(tempscore);		
						perfect++;
						// console.log("perfect:"+perfect);
						tempcombo++;
						m++;
						// 动画
						strlevel = "<img id='perfect"+m +"' style='position:absolute;top:40px;left:1.5%;z-index:4;width:10%;' src='../images/perfect.png'>";
						$("#dislevel").empty();
						document.getElementById("dislevel").innerHTML = document.getElementById("dislevel").innerHTML+strlevel; 
						$( "#" +"perfect" + m).animate({top:'-=60px',opacity:'0',width:'150px'},"slow",function() {
						});
						continue;
						}
					// right_cool
					if(parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth > 0.04 && parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth < 0.07){
						// console.log(m+":"+ parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth*100+"%");
						// console.log("right_cool");
						$("#"+"rhythm"+m).remove();
						tempscore += 3;
						$("#currentscore1").html(tempscore);					
						cool++;
						// console.log("cool:"+cool);
						tempcombo++;
						m++;	
						// 动画
						strlevel = "<img id='cool"+m +"' style='position:absolute;top:40px;left:1.5%;z-index:4;width:10%;' src='../images/cool.png'>";
						$("#dislevel").empty();
						document.getElementById("dislevel").innerHTML = document.getElementById("dislevel").innerHTML+strlevel; 
						$( "#" +"cool" + m).animate({top:'-=60px',opacity:'0',width:'150px'},"slow",function() {
						});
						continue;
						}	
					// right_miss
					if(parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth > 0.07 && parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth < 0.15||parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth < 0.01&&parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth > -0.01){
						// console.log(m+":"+ parseInt($("#"+"rhythm"+m).css("left"))/document.body.clientWidth*100+"%");
						// console.log("right_miss");					
						miss++;
						// console.log("miss:"+miss);						
						if(tempcombo > combo){
							combo = tempcombo;
							tempcombo = 0;
							// console.log("combo:"+combo);
							}
						else{
							tempcombo = 0;
						}
						m++;	
						// 动画
						strlevel = "<img id='miss"+m +"' style='position:absolute;top:40px;left:1.5%;z-index:4;width:10%;' src='../images/miss.png'>";
						$("#dislevel").empty();
						document.getElementById("dislevel").innerHTML = document.getElementById("dislevel").innerHTML+strlevel; 
						$( "#" +"miss" + m).animate({top:'-=60px',opacity:'0',width:'150px'},"slow",function() {
						});
						continue;
						}					
					else{
						continue;
					}
				}
			}
			});      
	}

	function getscore(){
		$.getJSON("../json/get_score.json",{"id":$.cookie('player_id'),"anotherid":getParameterByName("anotherid"),"score":$("#currentscore1").html()},function(data){
			$("#currentscore2").html(data[0].score);
		});
	}


	function changesize(){
		var newleft = document.body.clientWidth - parseInt($("#invent").css("width"))*13/18;
		// $("html").height($(window).height());
		// $("body").height(document.documentElement.clientHeight);
		$(".playername").css("left",newleft);
		$(".score").css("left",newleft);

		var fontsize = 18 * parseInt($("#invent").css("width"))/300;
		$(".playername").css("font-size",fontsize+"pt");
		$(".score").css("font-size",fontsize+"pt");

		var newtop1 = parseInt($("#invent").css("width"))/442*312*1/4;
		var _newtop1 = parseInt($("#invent").css("width"))/442*312*2/5;
		$("#playername1").css("top",newtop1);
		$("#score1").css("top",_newtop1);

		var newtop2 = parseInt($("#invent").css("width"))/442*312*26/39;
		var _newtop2 = parseInt($("#invent").css("width"))/442*312*14/17;
		$("#playername2").css("top",newtop2);
		$("#score2").css("top",_newtop2);

		var imgleft = document.body.clientWidth - parseInt($("#invent").css("width"))*17/18;
		var imgtop = parseInt($("#invent").css("top")) + parseInt($("#invent").css("width"))*13/90;
		var imgsize = parseInt($("#invent").css("width"))/6;
		$("#showavatar1").css("left",imgleft);
		$("#showavatar1").css("top",imgtop);
		$("#showavatar1").css("width",imgsize);

		var imgtop2 = parseInt($("#invent").css("top")) + parseInt($("#invent").css("width"))*41/90;
		$("#showavatar2").css("left",imgleft);
		$("#showavatar2").css("top",imgtop2);
		$("#showavatar2").css("width",imgsize);

		
	}

// })




function getParameterByName(name) {
	name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
	var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
	results = regex.exec(location.search);
	return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}
</script>
</html>